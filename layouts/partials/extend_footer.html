{{- /* GoatCounter Analytics */ -}}
{{ with .Site.Params.goatCounterCode }}
<script data-goatcounter="https://{{ . }}.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
{{ end }}

{{- /* Visitor counter badge - top right corner */ -}}
{{ if .Site.Params.showVisitorCount }}
<div id="visitor-counter" style="position: fixed; top: 80px; right: 20px; background: rgba(0, 0, 0, 0.8); padding: 10px 15px; border-radius: 8px; font-size: 0.9em; z-index: 999; box-shadow: 0 2px 10px rgba(0,0,0,0.4); color: #fff; font-family: monospace; display: flex; align-items: center; gap: 8px;">
  <span style="opacity: 0.8;">üëÅÔ∏è Visits:</span>
  <span id="gc-count" style="font-weight: bold;">...</span>
</div>
<script>
  (function() {
    var img = new Image();
    img.onload = function() {
      // SVG loaded, try to extract number
      fetch('https://giacomoettorerocco.goatcounter.com/counter/TOTAL.svg')
        .then(r => r.text())
        .then(svg => {
          var match = svg.match(/>(\d+)</);
          if (match) {
            document.getElementById('gc-count').textContent = match[1];
          } else {
            document.getElementById('gc-count').textContent = '4+';
          }
        })
        .catch(() => {
          document.getElementById('gc-count').textContent = '4+';
        });
    };
    img.onerror = function() {
      document.getElementById('gc-count').textContent = '4+';
    };
    img.src = 'https://giacomoettorerocco.goatcounter.com/counter/TOTAL.svg?' + Date.now();
  })();
</script>
{{ end }}
